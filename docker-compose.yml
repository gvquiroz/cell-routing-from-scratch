services:
  control-plane:
    build:
      context: .
      dockerfile: Dockerfile.control-plane
    ports:
      - "8081:8081"
    environment:
      - PORT=8081
      - CONFIG_PATH=/app/config/routing.json
    volumes:
      - ./config:/app/config
    networks:
      - cell-network

  router:
    build:
      context: .
      dockerfile: Dockerfile.router
    ports:
      - "8080:8080"
    environment:
      - PORT=8080
      - CONFIG_PATH=/app/config/dataplane-initial.json
      - CONTROL_PLANE_URL=ws://control-plane:8081/connect
    volumes:
      - ./config:/app/config
    depends_on:
      - control-plane
      - cell-tier1
      - cell-tier2
      - cell-tier3
      - cell-visa
    networks:
      - cell-network

  cell-tier1:
    build:
      context: .
      dockerfile: Dockerfile.cell
    environment:
      - CELL_NAME=tier1
      - PORT=9001
    expose:
      - "9001"
    networks:
      - cell-network

  cell-tier2:
    build:
      context: .
      dockerfile: Dockerfile.cell
    environment:
      - CELL_NAME=tier2
      - PORT=9002
    expose:
      - "9002"
    networks:
      - cell-network

  cell-tier3:
    build:
      context: .
      dockerfile: Dockerfile.cell
    environment:
      - CELL_NAME=tier3
      - PORT=9003
    expose:
      - "9003"
    networks:
      - cell-network

  cell-visa:
    build:
      context: .
      dockerfile: Dockerfile.cell
    environment:
      - CELL_NAME=visa
      - PORT=9004
    expose:
      - "9004"
    networks:
      - cell-network

networks:
  cell-network:
    driver: bridge
